<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>DienVL v3</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-black text-white h-screen flex flex-col">

  <!-- Navigation -->
  <nav class="flex justify-around bg-gray-900 p-2 text-sm">
    <button onclick="showSection('calculator')" class="px-2">Máy tính</button>
    <button onclick="showSection('ticTacToe')" class="px-2">Caro</button>
    <button onclick="showSection('snake')" class="px-2">Rắn</button>
    <button onclick="showSection('notes')" class="px-2">Ghi chú</button>
  </nav>

  <!-- Calculator -->
  <section id="calculator" class="flex-1 flex flex-col items-center justify-center p-4">
    <div class="w-full max-w-xs">
      <input type="text" id="calc-display" readonly
        class="w-full text-right text-3xl p-3 mb-4 rounded bg-gray-900 border border-gray-700" />
      <div class="grid grid-cols-4 gap-2">
        <button class="calc-btn">7</button>
        <button class="calc-btn">8</button>
        <button class="calc-btn">9</button>
        <button class="calc-btn bg-red-600">C</button>

        <button class="calc-btn">4</button>
        <button class="calc-btn">5</button>
        <button class="calc-btn">6</button>
        <button class="calc-btn">/</button>

        <button class="calc-btn">1</button>
        <button class="calc-btn">2</button>
        <button class="calc-btn">3</button>
        <button class="calc-btn">*</button>

        <button class="calc-btn col-span-2">0</button>
        <button class="calc-btn">.</button>
        <button class="calc-btn">+</button>

        <button class="calc-btn col-span-2">-</button>
        <button class="calc-btn col-span-2">=</button>
      </div>
    </div>
  </section>

  <!-- Tic Tac Toe -->
  <section id="ticTacToe" class="hidden flex-1 flex flex-col items-center justify-center">
    <h2 class="mb-4 text-xl font-bold">Caro</h2>
    <div id="board" class="grid grid-cols-3 gap-2"></div>
    <p id="tictactoe-status" class="mt-2"></p>
    <button onclick="resetBoard()" class="mt-4 px-4 py-2 bg-gray-800 rounded">Chơi lại</button>
  </section>

  <!-- Snake -->
  <section id="snake" class="hidden flex-1 flex flex-col items-center justify-center">
    <h2 class="mb-2 text-xl font-bold">Rắn</h2>
    <canvas id="snakeCanvas" width="200" height="200" class="border border-white"></canvas>
    <p id="snake-score" class="mt-2">Điểm: 0</p>
    <button onclick="startSnake()" class="mt-2 px-4 py-2 bg-gray-800 rounded">Bắt đầu</button>
  </section>

  <!-- Notes -->
  <section id="notes" class="hidden flex-1 flex flex-col p-4">
    <h2 class="mb-2 text-xl font-bold">Ghi chú</h2>
    <textarea id="noteText" class="flex-1 p-2 rounded bg-gray-900 border border-gray-700"></textarea>
    <button onclick="saveNote()" class="mt-2 px-4 py-2 bg-gray-800 rounded">Lưu</button>
  </section>

<script>
// Navigation
function showSection(id) {
  document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
}

// Calculator
let calcDisplay = document.getElementById('calc-display');
document.querySelectorAll('.calc-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    let val = btn.innerText;
    if (val === 'C') {
      calcDisplay.value = '';
    } else if (val === '=') {
      try { calcDisplay.value = eval(calcDisplay.value); } catch { calcDisplay.value = 'Err'; }
    } else {
      calcDisplay.value += val;
    }
  });
});

// Tic Tac Toe (unbeatable minimax bot)
const boardEl = document.getElementById("board");
let cells = [];
let board = ["", "", "", "", "", "", "", "", ""];
function createBoard() {
  boardEl.innerHTML = "";
  board = ["", "", "", "", "", "", "", "", ""];
  for (let i=0;i<9;i++) {
    const cell = document.createElement("button");
    cell.className = "w-16 h-16 bg-gray-800 text-2xl";
    cell.onclick = () => playerMove(i);
    boardEl.appendChild(cell);
    cells[i] = cell;
  }
}
function playerMove(i) {
  if (board[i] !== "") return;
  board[i] = "X"; cells[i].innerText = "X";
  if (checkWin(board,"X")) { setStatus("Bạn thắng!"); return; }
  aiMove();
}
function aiMove() {
  let best = -Infinity, move = -1;
  for (let i=0;i<9;i++) {
    if (board[i]==="") {
      board[i] = "O";
      let score = minimax(board,0,false);
      board[i] = "";
      if (score>best){best=score;move=i;}
    }
  }
  if (move!==-1){board[move]="O";cells[move].innerText="O";}
  if (checkWin(board,"O")) setStatus("Bot thắng!");
}
function minimax(b,depth,isMax){
  if(checkWin(b,"O")) return 10-depth;
  if(checkWin(b,"X")) return depth-10;
  if(!b.includes("")) return 0;
  if(isMax){
    let best=-Infinity;
    for(let i=0;i<9;i++){if(b[i]===""){b[i]="O";best=Math.max(best,minimax(b,depth+1,false));b[i]="";}}
    return best;
  } else {
    let best=Infinity;
    for(let i=0;i<9;i++){if(b[i]===""){b[i]="X";best=Math.min(best,minimax(b,depth+1,true));b[i]="";}}
    return best;
  }
}
function checkWin(b,p){const w=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];return w.some(line=>line.every(i=>b[i]===p));}
function setStatus(msg){document.getElementById("tictactoe-status").innerText=msg;}
function resetBoard(){createBoard();setStatus("");}
createBoard();

// Snake
let ctx=document.getElementById("snakeCanvas").getContext("2d");
let snake,dx,dy,food,score,snakeInterval;
function startSnake(){
  snake=[{x:10,y:10}];dx=10;dy=0;food={x:50,y:50};score=0;
  clearInterval(snakeInterval);
  snakeInterval=setInterval(drawSnake,200);
}
function drawSnake(){
  ctx.fillStyle="black";ctx.fillRect(0,0,200,200);
  ctx.fillStyle="lime";snake.forEach(p=>ctx.fillRect(p.x,p.y,10,10));
  ctx.fillStyle="red";ctx.fillRect(food.x,food.y,10,10);
  let head={x:snake[0].x+dx,y:snake[0].y+dy};
  if(head.x<0||head.y<0||head.x>=200||head.y>=200||snake.some(p=>p.x===head.x&&p.y===head.y)){
    clearInterval(snakeInterval);return;
  }
  snake.unshift(head);
  if(head.x===food.x&&head.y===food.y){score++;document.getElementById("snake-score").innerText="Điểm: "+score;food={x:Math.floor(Math.random()*20)*10,y:Math.floor(Math.random()*20)*10};}
  else snake.pop();
}
document.addEventListener("keydown",e=>{if(e.key==="ArrowUp"&&dy===0){dx=0;dy=-10;}if(e.key==="ArrowDown"&&dy===0){dx=0;dy=10;}if(e.key==="ArrowLeft"&&dx===0){dx=-10;dy=0;}if(e.key==="ArrowRight"&&dx===0){dx=10;dy=0;}});

// Notes
function saveNote(){
  localStorage.setItem("dienvl_note",document.getElementById("noteText").value);
}
document.getElementById("noteText").value=localStorage.getItem("dienvl_note")||"";
</script>

<style>
  .calc-btn { @apply bg-gray-800 text-white rounded p-4 text-xl font-bold text-center; }
  .calc-btn:active { @apply bg-gray-600; }
</style>

</body>
</html>
