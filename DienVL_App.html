<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>DienVL App v3</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background-color: #000; color: #fff; }
    .hidden { display: none; }
    .menu-btn { @apply bg-gray-800 p-3 rounded text-sm; }
    .calc-btn { @apply bg-gray-800 text-white rounded p-4 text-xl font-bold; }
    .calc-btn:active { @apply bg-gray-600; }
  </style>
</head>
<body class="flex flex-col h-screen">
  <nav class="bg-black p-2 flex justify-around text-xs border-b border-gray-700">
    <button onclick="show('calc')" class="menu-btn">Máy tính</button>
    <button onclick="show('ttt')" class="menu-btn">Caro</button>
    <button onclick="show('snake')" class="menu-btn">Rắn</button>
    <button onclick="show('notes')" class="menu-btn">Ghi chú</button>
  </nav>

  <!-- Calculator -->
  <section id="calc" class="flex-1 flex items-center justify-center">
    <div class="w-full max-w-xs p-4">
      <input type="text" id="calc-display" readonly
        class="w-full text-right text-3xl p-3 mb-4 rounded bg-gray-900 border border-gray-700" />
      <div class="grid grid-cols-4 gap-2">
        <button class="calc-btn">7</button>
        <button class="calc-btn">8</button>
        <button class="calc-btn">9</button>
        <button class="calc-btn bg-red-600">C</button>

        <button class="calc-btn">4</button>
        <button class="calc-btn">5</button>
        <button class="calc-btn">6</button>
        <button class="calc-btn">/</button>

        <button class="calc-btn">1</button>
        <button class="calc-btn">2</button>
        <button class="calc-btn">3</button>
        <button class="calc-btn">*</button>

        <button class="calc-btn">0</button>
        <button class="calc-btn">.</button>
        <button class="calc-btn">=</button>
        <button class="calc-btn">+</button>

        <button class="calc-btn col-span-4">-</button>
      </div>
    </div>
  </section>

  <!-- Tic Tac Toe -->
  <section id="ttt" class="hidden flex-1 flex flex-col items-center justify-center">
    <div id="ttt-board" class="grid grid-cols-3 gap-2"></div>
    <p id="ttt-status" class="mt-2 text-center"></p>
  </section>

  <!-- Snake -->
  <section id="snake" class="hidden flex-1 flex flex-col items-center justify-center">
    <canvas id="snake-canvas" width="300" height="300" class="border border-gray-700"></canvas>
    <p id="snake-score" class="mt-2"></p>
  </section>

  <!-- Notes -->
  <section id="notes" class="hidden flex-1 flex flex-col items-center justify-center p-4">
    <textarea id="notes-text" class="w-full h-full bg-gray-900 text-white p-2 rounded"></textarea>
  </section>

<script>
function show(id){
  document.querySelectorAll('section').forEach(s=>s.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
}

// Calculator logic
let display = document.getElementById("calc-display");
document.querySelectorAll(".calc-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    let val = btn.innerText;
    if(val === "C"){ display.value = ""; }
    else if(val === "="){ try { display.value = eval(display.value); } catch { display.value = "Err"; } }
    else { display.value += val; }
  });
});

// Tic Tac Toe logic (AI bot)
const tttBoard = document.getElementById("ttt-board");
let cells = Array(9).fill("");
function renderTTT(){
  tttBoard.innerHTML="";
  cells.forEach((val,i)=>{
    let b=document.createElement("button");
    b.className="w-20 h-20 bg-gray-800 text-3xl";
    b.innerText=val;
    b.onclick=()=>move(i);
    tttBoard.appendChild(b);
  });
}
function move(i){
  if(cells[i]) return;
  cells[i]="X";
  if(checkWin("X")) { document.getElementById("ttt-status").innerText="Bạn thắng!"; return; }
  aiMove();
  if(checkWin("O")) document.getElementById("ttt-status").innerText="Bot thắng!";
}
function aiMove(){
  for(let i=0;i<9;i++){ if(!cells[i]){ cells[i]="O"; break; } }
  renderTTT();
}
function checkWin(p){ return ([0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]).some(line=>line.every(idx=>cells[idx]==p)); }
renderTTT();

// Snake game
const canvas=document.getElementById("snake-canvas");
const ctx=canvas.getContext("2d");
let snake=[{x:10,y:10}];
let dir={x:0,y:0};
let food={x:15,y:15};
let score=0;
document.addEventListener("keydown",e=>{
  if(e.key==="ArrowUp") dir={x:0,y:-1};
  if(e.key==="ArrowDown") dir={x:0,y:1};
  if(e.key==="ArrowLeft") dir={x:-1,y:0};
  if(e.key==="ArrowRight") dir={x:1,y:0};
});
function loop(){
  ctx.fillStyle="black";ctx.fillRect(0,0,300,300);
  snake=[{x:snake[0].x+dir.x,y:snake[0].y+dir.y},...snake.slice(0,-1)];
  if(snake[0].x===food.x && snake[0].y===food.y){
    snake.push({...snake[snake.length-1]}); food={x:Math.floor(Math.random()*30),y:Math.floor(Math.random()*30)}; score++;
  }
  ctx.fillStyle="lime"; snake.forEach(p=>ctx.fillRect(p.x*10,p.y*10,10,10));
  ctx.fillStyle="red"; ctx.fillRect(food.x*10,food.y*10,10,10);
  document.getElementById("snake-score").innerText="Điểm: "+score;
}
setInterval(loop,200);

// Notes
const notes=document.getElementById("notes-text");
notes.value=localStorage.getItem("dienvl_notes")||"";
notes.addEventListener("input",()=>localStorage.setItem("dienvl_notes",notes.value));
</script>
</body>
</html>