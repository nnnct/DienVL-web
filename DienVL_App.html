<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>DienVL v4</title>
<link rel="icon" href="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='512' height='512' viewBox='0 0 512 512'>  <defs>    <linearGradient id='g' x1='0' x2='1' y1='0' y2='1'>      <stop offset='0' stop-color='#00e6a8'/>      <stop offset='0.5' stop-color='#7dd3fc'/>      <stop offset='1' stop-color='#ff4dff'/>    </linearGradient>    <filter id='glow' x='-50%' y='-50%' width='200%' height='200%'>      <feGaussianBlur stdDeviation='8' result='coloredBlur'/>      <feMerge>        <feMergeNode in='coloredBlur'/>        <feMergeNode in='SourceGraphic'/>      </feMerge>    </filter>  </defs>  <rect width='100%' height='100%' fill='#000'/>  <g filter='url(#glow)'>    <path d='M120 100 C200 40, 350 40, 380 140 C410 240, 300 260, 260 260 C340 260, 420 300, 370 380 C320 460, 180 460, 120 380 Z'          fill='url(#g)' transform='translate(20,20) rotate(-8 256 256)'/>    <path d='M140 140 C220 80, 340 80, 360 160 C380 240, 300 260, 260 260 C320 260, 380 300, 340 360 C300 420, 200 420, 160 360 Z'          fill='none' stroke='white' stroke-opacity='0.12' stroke-width='6' transform='translate(20,20) rotate(-8 256 256)'/>  </g>  <text x='68%' y='62%' font-family='Impact, Arial' font-size='220' fill='white' fill-opacity='0.95'         transform='translate(-60,0) rotate(-8 200 200)' style='font-weight:900; letter-spacing:2'>D</text></svg>" />
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#000000">
<style>
  :root{{--bg:#000;--panel:#070707;--muted:#9aa0a6;--neon1:#00e6a8;--neon2:#7dd3fc;--neon3:#ff4dff}}
  html,body{{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:var(--bg);color:#e9f2ff;-webkit-font-smoothing:antialiased;}}
  .app{{max-width:980px;margin:0 auto;padding:10px;min-height:100vh;display:flex;flex-direction:column;gap:10px;box-sizing:border-box}}
  header{{display:flex;align-items:center;gap:10px;justify-content:center}}
  .logo{{width:56px;height:56px;border-radius:12px;overflow:hidden;box-shadow:0 6px 18px rgba(125,211,252,0.06);background:#000;border:1px solid rgba(255,255,255,0.03)}}
  h1{{margin:0;font-size:18px;color:var(--neon1);letter-spacing:1.5px}}
  .nav{{display:flex;gap:8px;justify-content:center;flex-wrap:wrap}}
  .tab{{padding:8px 12px;border-radius:10px;background:linear-gradient(180deg,#050505,#0a0a0a);border:1px solid rgba(255,255,255,0.03);color:var(--neon2);font-weight:700}}
  .tab.inactive{{opacity:0.55;color:var(--muted)}}
  .panel{{background:linear-gradient(180deg, #040404, #0d0d0d);border-radius:12px;padding:12px;display:none;box-shadow:inset 0 1px 0 rgba(255,255,255,0.02)}}
  .panel.active{{display:block}}
  .row{{display:flex;gap:8px;flex-wrap:wrap;align-items:center}}
  .full{{width:100%}}
  button, input, select, textarea{{background:#070707;border:1px solid rgba(255,255,255,0.03);color:#e9f2ff;padding:10px;border-radius:10px;font-size:16px}}
  .neon-btn{{background:linear-gradient(90deg,var(--neon1),var(--neon2),var(--neon3));color:#001;border:none;padding:10px 14px;border-radius:10px;font-weight:800;box-shadow:0 6px 20px rgba(0,0,0,0.6)}}
  .muted{{color:var(--muted);font-size:13px}}

  /* calculator grid */
  .calc-grid{{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-top:10px}}
  .calc-display{{background:#000;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);font-size:28px;text-align:right}}

  /* poker layout */
  .poker-table{{display:flex;flex-direction:column;gap:10px;align-items:center}}
  .hand{{display:flex;gap:8px;align-items:center}}
  .card{{width:56px;height:80px;border-radius:8px;background:#050505;border:1px solid rgba(255,255,255,0.04);display:flex;align-items:center;justify-content:center;font-weight:800}}
  .card.red{{color:#ff4d4d}}
  .card.black{{color:#fff}}

  /* dice */
  .dice-row{{display:flex;gap:8px;align-items:center;justify-content:center;margin-top:8px}}
  .dice{{width:56px;height:56px;border-radius:8px;background:#050505;display:flex;align-items:center;justify-content:center;font-size:22px}}

  /* responsive */
  @media (max-width:420px){{ .card{{width:46px;height:66px;font-size:14px}} .calc-display{{font-size:22px}} }}
</style>
</head>
<body>
<div class="app">
  <header>
    <div class="logo" id="logo"><svg xmlns='http://www.w3.org/2000/svg' width='512' height='512' viewBox='0 0 512 512'>  <defs>    <linearGradient id='g' x1='0' x2='1' y1='0' y2='1'>      <stop offset='0' stop-color='#00e6a8'/>      <stop offset='0.5' stop-color='#7dd3fc'/>      <stop offset='1' stop-color='#ff4dff'/>    </linearGradient>    <filter id='glow' x='-50%' y='-50%' width='200%' height='200%'>      <feGaussianBlur stdDeviation='8' result='coloredBlur'/>      <feMerge>        <feMergeNode in='coloredBlur'/>        <feMergeNode in='SourceGraphic'/>      </feMerge>    </filter>  </defs>  <rect width='100%' height='100%' fill='#000'/>  <g filter='url(#glow)'>    <path d='M120 100 C200 40, 350 40, 380 140 C410 240, 300 260, 260 260 C340 260, 420 300, 370 380 C320 460, 180 460, 120 380 Z'          fill='url(#g)' transform='translate(20,20) rotate(-8 256 256)'/>    <path d='M140 140 C220 80, 340 80, 360 160 C380 240, 300 260, 260 260 C320 260, 380 300, 340 360 C300 420, 200 420, 160 360 Z'          fill='none' stroke='white' stroke-opacity='0.12' stroke-width='6' transform='translate(20,20) rotate(-8 256 256)'/>  </g>  <text x='68%' y='62%' font-family='Impact, Arial' font-size='220' fill='white' fill-opacity='0.95'         transform='translate(-60,0) rotate(-8 200 200)' style='font-weight:900; letter-spacing:2'>D</text></svg></div>
    <h1 style="text-transform:uppercase">DIENVL</h1>
  </header>

  <nav class="nav" id="nav">
    <button class="tab" data-target="calc">Máy tính</button>
    <button class="tab inactive" data-target="dice">Xúc xắc</button>
    <button class="tab inactive" data-target="poker">21 Poker</button>
    <button class="tab inactive" data-target="ttt">Caro AI</button>
    <button class="tab inactive" data-target="snake">Snake</button>
  </nav>

  <!-- Calculator -->
  <section id="calc" class="panel active">
    <div class="calc-display" id="calcScreen">0</div>
    <div class="calc-grid">
      <button class="neon-btn" onclick="calcPress('C')">C</button>
      <button class="neon-btn" onclick="calcPress('⌫')">⌫</button>
      <button class="neon-btn" onclick="calcPress('%')">%</button>
      <button class="neon-btn" onclick="calcPress('/')">÷</button>

      <button class="neon-btn" onclick="calcPress('7')">7</button>
      <button class="neon-btn" onclick="calcPress('8')">8</button>
      <button class="neon-btn" onclick="calcPress('9')">9</button>
      <button class="neon-btn" onclick="calcPress('*')">×</button>

      <button class="neon-btn" onclick="calcPress('4')">4</button>
      <button class="neon-btn" onclick="calcPress('5')">5</button>
      <button class="neon-btn" onclick="calcPress('6')">6</button>
      <button class="neon-btn" onclick="calcPress('-')">−</button>

      <button class="neon-btn" onclick="calcPress('1')">1</button>
      <button class="neon-btn" onclick="calcPress('2')">2</button>
      <button class="neon-btn" onclick="calcPress('3')">3</button>
      <button class="neon-btn" onclick="calcPress('+')">+</button>

      <button class="neon-btn" style="grid-column:span 2" onclick="calcPress('0')">0</button>
      <button class="neon-btn" onclick="calcPress('.')">.</button>
      <button class="neon-btn" onclick="calcPress('=')">=</button>
    </div>
  </section>

  <!-- Dice -->
  <section id="dice" class="panel">
    <div class="row">
      <label class="muted">Số xúc xắc</label>
      <select id="diceCount"><option>1</option><option selected>2</option><option>3</option><option>4</option></select>
      <button class="neon-btn" onclick="rollDice()">Quay</button>
    </div>
    <div class="dice-row" id="diceRow"></div>
    <div class="muted" id="diceTotal"></div>
  </section>

  <!-- 21 Poker (Blackjack-like) -->
  <section id="poker" class="panel">
    <div class="poker-table">
      <div class="muted">Số dư: <span id="bank">1000</span>  — Cược hiện tại: <span id="bet">50</span></div>
      <div class="row" style="gap:6px">
        <button class="neon-btn" onclick="changeBet(-10)">-10</button>
        <button class="neon-btn" onclick="changeBet(10)">+10</button>
        <button class="neon-btn" onclick="setBetAll()">Tất cả</button>
        <button class="neon-btn" onclick="deal()">Chia bài</button>
      </div>
      <div style="width:100%;display:flex;justify-content:space-between;align-items:flex-start;margin-top:10px">
        <div style="width:48%">
          <div class="muted">Nhà (ẩn 1 lá)</div>
          <div class="hand" id="dealerHand"></div>
          <div class="muted">Tổng: <span id="dealerTotal">?</span></div>
        </div>
        <div style="width:48%">
          <div class="muted">Bạn</div>
          <div class="hand" id="playerHand"></div>
          <div class="muted">Tổng: <span id="playerTotal">0</span></div>
        </div>
      </div>
      <div class="row" style="margin-top:10px;gap:8px">
        <button class="neon-btn" onclick="playerHit()">Rút</button>
        <button class="neon-btn" onclick="playerStand()">Dừng</button>
        <button class="neon-btn" onclick="playerDouble()">Gấp đôi</button>
        <button class="neon-btn" onclick="newRound()">Vòng mới</button>
      </div>
      <div class="muted" id="pokerMsg"></div>
    </div>
  </section>

  <!-- other panels (ttt, snake) placeholders -->
  <section id="ttt" class="panel">
    <div class="muted">Caro AI (unchanged)</div>
  </section>
  <section id="snake" class="panel">
    <div class="muted">Snake (unchanged)</div>
  </section>

  <footer style="height:20px"></footer>
</div>

<script>
// Navigation
document.querySelectorAll('.tab').forEach(t=>t.addEventListener('click', ()=>{
  document.querySelectorAll('.tab').forEach(x=>x.classList.add('inactive'));
  t.classList.remove('inactive');
  const target = t.dataset.target;
  document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
  document.getElementById(target).classList.add('active');
}));

// Calculator logic
let calcExp='';
const calcScreen = document.getElementById('calcScreen');
function calcPress(k){
  if(k==='C'){ calcExp=''; calcScreen.textContent='0'; return; }
  if(k==='⌫'){ calcExp = calcExp.slice(0,-1); calcScreen.textContent = calcExp || '0'; return; }
  if(k==='='){ try{ let res = Function('return '+calcExp)(); calcScreen.textContent = String(res); calcExp = String(res);}catch(e){ calcScreen.textContent='Error'; calcExp=''; } return; }
  if(k==='%'){ try{ let v = Function('return '+calcExp)(); v = v/100; calcScreen.textContent=String(v); calcExp=String(v);}catch(e){} return; }
  // sanitize input: allow digits and operators
  if(!/^[0-9+\-*/.%()]*$/.test(k) && k!=='.'){};
  calcExp += k;
  calcScreen.textContent = calcExp;
}
document.addEventListener('keydown', e=>{ const k=e.key; if(/^[0-9+\-*/.%()]$/.test(k)||k==='Enter'||k==='Backspace'){ e.preventDefault(); if(k==='Enter') calcPress('='); else if(k==='Backspace') calcPress('⌫'); else calcPress(k); } });

// Dice roller
function rollDice(){
  const n = parseInt(document.getElementById('diceCount').value,10)||2;
  const row = document.getElementById('diceRow'); row.innerHTML='';
  let total=0;
  for(let i=0;i<n;i++){
    const v = Math.floor(Math.random()*6)+1;
    total += v;
    const d = document.createElement('div'); d.className='dice'; d.textContent = v;
    row.appendChild(d);
  }
  document.getElementById('diceTotal').textContent = 'Tổng: '+total;
}

// 21 Poker (Blackjack-like) implementation
let deck = [], player=[], dealer=[], bank=1000, bet=50, inRound=false, doubled=false;
const suits = ['♠','♥','♦','♣'];
function buildDeck(){
  deck=[];
  const vals = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
  for(const s of suits) for(const v of vals) deck.push({suit:s, val:v});
  // shuffle
  for(let i=deck.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [deck[i],deck[j]]=[deck[j],deck[i]]; }
}
function cardValue(card){
  if(card.val==='A') return 11;
  if(['J','Q','K'].includes(card.val)) return 10;
  return Number(card.val);
}
function handTotal(h){
  let total=0, aces=0;
  for(const c of h){ if(c.val==='A'){aces++; total+=11;} else total+=cardValue(c); }
  while(total>21 && aces>0){ total-=10; aces--; }
  return total;
}
function renderHands(reveal=false){
  const ph = document.getElementById('playerHand'); ph.innerHTML='';
  for(const c of player){ const el=document.createElement('div'); el.className='card '+(c.suit==='♥'||c.suit==='♦'?'red':'black'); el.textContent=c.val+c.suit; ph.appendChild(el); }
  document.getElementById('playerTotal').textContent = handTotal(player);

  const dh = document.getElementById('dealerHand'); dh.innerHTML='';
  for(let i=0;i<dealer.length;i++){
    const c = dealer[i];
    const el=document.createElement('div'); el.className='card '+(c.suit==='♥'||c.suit==='♦'?'red':'black');
    if(i===0 && !reveal && inRound) { el.textContent='?'; el.style.opacity=0.6; } else { el.textContent=c.val+c.suit; }
    dh.appendChild(el);
  }
  document.getElementById('dealerTotal').textContent = reveal ? handTotal(dealer) : '?';
}
function changeBet(x){ if(inRound) return; bet = Math.max(10, Math.min(bank, bet + x)); document.getElementById('bet').textContent = bet; }
function setBetAll(){ if(inRound) return; bet = Math.max(10, bank); document.getElementById('bet').textContent = bet; }
function deal(){
  if(inRound) return;
  if(bet>bank){ alert('Không đủ tiền'); return; }
  inRound=true; doubled=false;
  buildDeck();
  player=[]; dealer=[];
  player.push(deck.pop()); dealer.push(deck.pop()); player.push(deck.pop()); dealer.push(deck.pop());
  renderHands(false);
  document.getElementById('pokerMsg').textContent='Đang chơi...';
  // check for natural blackjack
  const pTot = handTotal(player), dTot = handTotal(dealer);
  if(pTot===21){
    // immediate payout (1.5x)
    const win = Math.floor(bet*1.5);
    bank += win;
    document.getElementById('bank').textContent = bank;
    document.getElementById('pokerMsg').textContent = 'Blackjack! Bạn thắng '+win;
    inRound=false; renderHands(true); return;
  }
  renderHands(false);
}
function playerHit(){
  if(!inRound) return;
  player.push(deck.pop()); renderHands(false);
  const t = handTotal(player);
  if(t>21){ // bust
    document.getElementById('pokerMsg').textContent = 'Bạn thua (bust)'; bank -= bet*(doubled?2:1); document.getElementById('bank').textContent=bank; inRound=false; renderHands(true); }
}
function playerStand(){
  if(!inRound) return;
  // dealer plays by simple rules: hit until 17 or higher
  while(handTotal(dealer) < 17){ dealer.push(deck.pop()); }
  const pt = handTotal(player), dt = handTotal(dealer);
  let msg='';
  if(dt>21 || pt>dt){ msg='Bạn thắng'; bank += bet*(doubled?2:1); }
  else if(pt===dt){ msg='Hoà'; }
  else { msg='Bạn thua'; bank -= bet*(doubled?2:1); }
  document.getElementById('pokerMsg').textContent = msg + ' (Bạn:'+pt+' Nhà:'+dt+')';
  document.getElementById('bank').textContent = bank;
  inRound=false; renderHands(true);
}
function playerDouble(){
  if(!inRound) return;
  if(bank < bet*2){ alert('Không đủ tiền để gấp đôi'); return; }
  // take one card and stand, double the bet
  doubled=true; player.push(deck.pop()); renderHands(false);
  if(handTotal(player)>21){ document.getElementById('pokerMsg').textContent='Bạn thua (bust)'; bank -= bet*2; document.getElementById('bank').textContent=bank; inRound=false; renderHands(true); return; }
  // proceed to dealer
  playerStand();
}
function newRound(){
  inRound=false; doubled=false; document.getElementById('pokerMsg').textContent=''; player=[]; dealer=[]; renderHands(true);
}
function initPoker(){
  document.getElementById('bank').textContent = bank;
  document.getElementById('bet').textContent = bet;
  renderHands(true);
}
initPoker();

</script>
</body>
</html>
